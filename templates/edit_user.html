{% extends "layout.html" %}

{% block title %}Edit User - {{ user_to_edit.username }}{% endblock %}

{% block content %}
<h1 class="text-2xl font-semibold mb-4">Edit User: {{ user_to_edit.username }}</h1>

<div class="bg-white rounded-xl shadow p-4 max-w-lg mx-auto">
  <form method="post" action="/admin/users/{{ user_to_edit.id }}/edit" class="space-y-6">

    <div>
      <h3 class="text-md font-semibold mb-2">Permissions</h3>
      <div class="grid grid-cols-2 gap-4">
        <div class="flex items-center gap-2">
          <input type="checkbox" id="is_admin" name="is_admin" value="true" {% if user_to_edit.is_admin %}checked{% endif %} class="h-4 w-4">
          <label for="is_admin" class="text-sm font-medium">Is Admin (Grants all permissions)</label>
        </div>
        <div class="flex items-center gap-2">
          <input type="checkbox" id="can_manage_allocations" name="can_manage_allocations" value="true" {% if user_to_edit.can_manage_allocations %}checked{% endif %} class="h-4 w-4">
          <label for="can_manage_allocations" class="text-sm font-medium">Can Manage Allocations</label>
        </div>
        <div class="flex items-center gap-2">
          <input type="checkbox" id="can_upload_config" name="can_upload_config" value="true" {% if user_to_edit.can_upload_config %}checked{% endif %} class="h-4 w-4">
          <label for="can_upload_config" class="text-sm font-medium">Can Upload Config</label>
        </div>
        <div class="flex items-center gap-2">
          <input type="checkbox" id="can_manage_clients" name="can_manage_clients" value="true" {% if user_to_edit.can_manage_clients %}checked{% endif %} class="h-4 w-4">
          <label for="can_manage_clients" class="text-sm font-medium">Can Manage Clients</label>
        </div>
        <div class="flex items-center gap-2">
          <input type="checkbox" id="can_manage_nat" name="can_manage_nat" value="true" {% if user_to_edit.can_manage_nat %}checked{% endif %} class="h-4 w-4">
          <label for="can_manage_nat" class="text-sm font-medium">Can Manage NAT IPs</label>
        </div>
        <div class="flex items-center gap-2">
          <input type="checkbox" id="can_view_churn" name="can_view_churn" value="true" {% if user_to_edit.can_view_churn %}checked{% endif %} class="h-4 w-4">
          <label for="can_view_churn" class="text-sm font-medium">Can View Churn</label>
        </div>
        <div class="flex items-center gap-2">
          <input type="checkbox" id="can_view_clients" name="can_view_clients" value="true" {% if user_to_edit.can_view_clients %}checked{% endif %} class="h-4 w-4">
          <label for="can_view_clients" class="text-sm font-medium">Can View Clients</label>
        </div>
        <div class="flex items-center gap-2">
          <input type="checkbox" id="can_view_nat" name="can_view_nat" value="true" {% if user_to_edit.can_view_nat %}checked{% endif %} class="h-4 w-4">
          <label for="can_view_nat" class="text-sm font-medium">Can View NAT IPs</label>
        </div>
        <div class="flex items-center gap-2">
          <input type="checkbox" id="can_manage_core_devices" name="can_manage_core_devices" value="true" {% if user_to_edit.can_manage_core_devices %}checked{% endif %} class="h-4 w-4">
          <label for="can_manage_core_devices" class="text-sm font-medium">Can Manage Core Devices</label>
        </div>
        <div class="flex items-center gap-2">
          <input type="checkbox" id="can_view_core_devices" name="can_view_core_devices" value="true" {% if user_to_edit.can_view_core_devices %}checked{% endif %} class="h-4 w-4">
          <label for="can_view_core_devices" class="text-sm font-medium">Can View Core Devices</label>
        </div>
      </div>
    </div>

    <div>
        <h3 class="text-md font-semibold mb-2">Allowed IP Blocks</h3>
        <div class="space-y-2 max-h-60 overflow-y-auto border rounded-lg p-3">
            {% for block in all_blocks %}
                <div class="flex items-center gap-2">
                    <input type="checkbox" name="allowed_blocks" value="{{ block.id }}" id="block_{{ block.id }}"
                           {% if block.id in user_block_ids %}checked{% endif %} class="h-4 w-4">
                    <label for="block_{{ block.id }}" class="text-sm">{{ block.cidr }} ({{ block.description or 'No description' }})</label>
                </div>
            {% else %}
                <p class="text-sm text-gray-500">No IP blocks have been created.</p>
            {% endfor %}
        </div>
    </div>

    <div class="flex justify-end gap-3">
        <a href="/admin/users" class="bg-gray-200 text-gray-800 rounded px-4 py-2 hover:bg-gray-300">Cancel</a>
        <button type="submit" class="bg-gray-900 text-white rounded px-4 py-2">Save Changes</button>
    </div>
  </form>
</div>
{% endblock %}
